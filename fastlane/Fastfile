# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane
# 一定要关闭 Automatically manage signing
# Iron-xzsl-dozt-hjbh
# fastlaneTravisCI

default_platform(:ios)
# https://docs.fastlane.tools/best-practices/continuous-integration/
ENV["MATCH_PASSWORD"] = "123456"
ENV["FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD"] = "Iron-xzsl-dozt-hjbh"
ENV["FASTLANE_SESSION"] = "---\n- !ruby/object:HTTP::Cookie\n  name: DES51fd2e5cb5569a953db89f4370ef3087c\n  value: HSARMTKNSRVXWFlaLJ1s+5P519JSRqjkKqqbyyOlUzm41mbpjhyAdhJaj/dBqa6i8zZPfywqZEz62/4GBAPLQ7wFQBnGDJn7o5TBX6JeW2Ty8P7XO7BZ+Ht3ysN4Zbmr3xrNcpU=SRVX\n  domain: idmsa.apple.com\n  for_domain: true\n  path: "/"\n  secure: true\n  httponly: true\n  expires: \n  max_age: 2592000\n  created_at: 2020-05-28 00:09:11.927784000 +08:00\n  accessed_at: 2020-06-20 19:11:30.747235000 +08:00\n- !ruby/object:HTTP::Cookie\n  name: myacinfo\n  value: DAWTKNV28bcc096b00c79ad86bd21e0fa6c45591a5cd5e1c0dc305889d23559132e114adc0459de3ee9fd0991517192044ab3fe08521cf9d4bcc04afa06808b4ba40636c47653239d1b40268bc101dbdfb7ac18e2ea88ae137a1ea16ffe9bb986f4bffe6ae3c8e25a62a328be790a1e53b98e4da3ca0393368c11e8fad4a2b591f4ae60e4d518c10a3a4b6d6f8e88dcfe8ab886c42ad0d9cbca96d32a61493ce51bc6228f8a165773f589e7cc9def1e144ffdc1d6b13851d4ca37f4be479d4924b895b15ca5b0cb510d5d7fc082d04f7770c987aa6b3154553ddc2ac01b14d80cc9cdd831a547f5d2d4e5d6536405dc4ec87016350744a51b5ae3b086f238d41b446940834323031383163353038313565376236386136613163636136316166636231666365376463666262MVRYV2\n  domain: apple.com\n  for_domain: true\n  path: "/"\n  secure: true\n  httponly: true\n  expires: \n  max_age: \n  created_at: 2020-06-20 19:11:34.848075000 +08:00\n  accessed_at: 2020-06-20 19:11:34.848765000 +08:00\n- !ruby/object:HTTP::Cookie\n  name: dqsid\n  value: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1OTI2NTE0OTUsImp0aSI6ImZfYVVKU0cyaTQxUXh2QVZEVHlBSkEifQ.IRF9bBCUfe4nJQIWlDrBkPgMD9o8o-5lI1E0HFD3Ue8\n  domain: appstoreconnect.apple.com\n  for_domain: false\n  path: "/"\n  secure: true\n  httponly: true\n  expires: \n  max_age: 1800\n  created_at: &1 2020-06-20 19:11:36.583560000 +08:00\n  accessed_at: *1\n"

platform :ios do
  desc "Description of what the lane does"
  lane :useMatch do

	register_devices(devices_file: "./devices.txt")

	# https://docs.fastlane.tools/actions/match/
	match(
		git_url: "https://gitee.com/yujinhai/HowToUseMatch.git",
		type: "adhoc",
		#readonly: true,
		force_for_new_devices: true
	)    

	# https://docs.fastlane.tools/actions/build_app/
  	build_app(
	 	export_xcargs: "-allowProvisioningUpdates", 
		export_method: "ad-hoc",
		scheme: "TravisCIDemo",
		output_directory: "~/Desktop/outputAPI"
	)

	# https://www.pgyer.com/doc/view/fastlane
	pgyer(
		api_key: "a215682d481d742271b61aabfe1baffe", 
		user_key: "06c794bc27fbe97b626a3a21f12419f5",
		password: "123456", 
		update_description: "ssssswww"
	)

  end
end
